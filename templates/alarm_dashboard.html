{% extends 'layout.html' %}
{% block head %}
{{ super() }}
<script>
    $( function() {
      $( "#accordion" ).accordion();
      $( "#days input" ).checkboxradio({
        icon: false
      });
    } );
  
    $( function() {
      let time = moment().format('h:mm:ss a');
      let data = null;
      let fetchAsyncA = async () => 
        await (await fetch('/alarm_times')
          .then(response => response.text().then(function(value) {
            data = value;
          })));
  
      fetchAsyncA();
      document.getElementById('time').innerHTML = time;
  
      setInterval(() => {
        date_data = JSON.parse(data)
        console.log(date_data);

        for (var i = 0; i < date_data.length; i++) {
          var seconds = (moment() - Date.parse(date_data[i]));

          console.log(seconds);
        }
    

        time = moment().format('h:mm:ss a');
        document.getElementById('time').innerHTML = time;
      }, 1000)
    } );

</script>
{% endblock %}

{% block body %}
  <h1>Alarm Dashboard</h1>
  <a class="btn btn-success" href="/set_alarm"> Set new alarm</a>
  <hr>

  <div id="accordion">
    {% for alarm in alarms %}
    <h3>{{alarm.alarm}} <span>{{alarm.title}}</span></h3>
    <div>
      <p>{% for day in alarm.dnames %}{{day}} {% endfor %}</p>
      <p>{{alarm.action}}</p>
      <a href="edit_alarm/{{alarm.id}}" class="btn btn-default pull-right">Edit</a>
      <form action="{{url_for('delete_alarm', id=alarm.id)}}" method="post">
        <input type="hidden" name="_method" value="DELETE">
        <input type="submit" value="Delete" class="btn btn-danger">
      </form>
    </div>
    {% endfor %}
  </div>

  <div style="padding-top: 10px;">
    <div id="time"></div>
  </div>

{% endblock %}
